<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babel - Diario de Desarrollo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0d0d0d;
            --bg-card: #111;
            --text-primary: #0f0;
            --text-secondary: #0a0;
            --text-tertiary: #666;
            --text-muted: #888;
            --border-color: #1a1a1a;
            --border-highlight: #333;
            --accent: #0f0;
            --accent-glow: rgba(0,255,0,0.1);
            --tag-setup: #f0f;
            --tag-bugfix: #f55;
            --tag-feature: #5f5;
            --tag-documentation: #ff5;
            --tag-refactor: #5ff;
            --tag-test: #0f0;
            --scrollbar-track: #0d0d0d;
            --scrollbar-thumb: #1a1a1a;
            --scrollbar-thumb-hover: #0f0;
        }
        
        body.light {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --bg-card: #e8eef5;
            --text-primary: #1a3a52;
            --text-secondary: #2d5a7a;
            --text-tertiary: #5a7a8a;
            --text-muted: #8a9aaa;
            --border-color: #c5d5e5;
            --border-highlight: #a5c5d5;
            --accent: #1a5fa5;
            --accent-glow: transparent;
            --tag-setup: #8a3ab5;
            --tag-bugfix: #c53a3a;
            --tag-feature: #3a8a3a;
            --tag-documentation: #b58a3a;
            --tag-refactor: #3ab5b5;
            --tag-test: #1a5fa5;
            --scrollbar-track: #e0e5eb;
            --scrollbar-thumb: #a5c5d5;
            --scrollbar-thumb-hover: #1a5fa5;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-primary);
            min-height: 100vh;
            transition: all 0.3s;
        }
        header {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-content {
            flex: 1;
        }
        header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        body:not(.light) header h1 {
            text-shadow: 0 0 10px var(--accent);
        }
        header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .theme-toggle:hover {
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        .container {
            display: flex;
            min-height: calc(100vh - 120px);
        }
        .timeline {
            width: 200px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--accent), var(--text-secondary));
        }
        .timeline-item {
            padding: 0.5rem 0.5rem 0.5rem 2.5rem;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background: var(--bg-secondary);
            border: 2px solid var(--accent);
            border-radius: 50%;
            transition: all 0.2s;
        }
        .timeline-item:hover::before {
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        .timeline-item:hover {
            background: var(--bg-card);
        }
        .timeline-item.active::before {
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        .timeline-date {
            color: var(--accent);
            font-size: 0.75rem;
            font-weight: bold;
        }
        .timeline-time {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }
        .timeline-title {
            color: var(--text-muted);
            font-size: 0.65rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: var(--bg-card);
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }
        .stat-card:hover {
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--accent);
        }
        body:not(.light) .stat-value {
            text-shadow: 0 0 5px var(--accent);
        }
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }
        .session {
            background: var(--bg-card);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--accent);
            transition: all 0.2s;
        }
        .session:hover {
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .session-title {
            font-size: 1rem;
            color: var(--text-primary);
            flex: 1;
        }
        .session-meta {
            color: var(--text-secondary);
            font-size: 0.7rem;
            text-align: right;
        }
        .session-tags {
            display: flex;
            gap: 0.25rem;
            margin: 0.5rem 0;
            flex-wrap: wrap;
        }
        .tag {
            background: var(--bg-secondary);
            color: var(--accent);
            padding: 0.15rem 0.5rem;
            border-radius: 2px;
            font-size: 0.65rem;
            border: 1px solid var(--border-color);
        }
        .tag.setup { color: var(--tag-setup); border-color: var(--border-highlight); }
        .tag.bugfix { color: var(--tag-bugfix); border-color: var(--border-highlight); }
        .tag.feature { color: var(--tag-feature); border-color: var(--border-highlight); }
        .tag.documentation { color: var(--tag-documentation); border-color: var(--border-highlight); }
        .tag.refactor { color: var(--tag-refactor); border-color: var(--border-highlight); }
        .tag.test { color: var(--tag-test); border-color: var(--border-highlight); }
        .session-summary {
            margin: 0.5rem 0;
            color: var(--text-tertiary);
            font-size: 0.8rem;
            line-height: 1.4;
        }
        .session-link {
            display: inline-block;
            margin-top: 0.5rem;
            color: var(--accent);
            text-decoration: none;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        body:not(.light) .session-link:hover {
            text-shadow: 0 0 5px var(--accent);
        }
        footer {
            text-align: center;
            padding: 1rem;
            color: var(--text-secondary);
            font-size: 0.7rem;
            border-top: 1px solid var(--border-color);
            margin-top: 1rem;
            background: var(--bg-secondary);
        }
        .footer-nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .footer-nav a {
            color: var(--text-primary);
            text-decoration: none;
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 0.65rem;
            transition: all 0.2s;
        }
        .footer-nav a:hover {
            border-color: var(--accent);
            box-shadow: 0 0 5px var(--accent-glow);
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 0.5rem;
            }
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>> BABEL_DEV_DIARY</h1>
            <p>Sistema de Gestión Documental con IA y OCR</p>
        </div>
        <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">☀/☾</button>
    </header>

    <div class="container">
        <div class="timeline" id="timeline">
            <!-- Timeline items se añadirán aquí dinámicamente -->
        </div>

        <main>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-sessions">14</div>
                <div class="stat-label">Sesiones Totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-hours">23.5h</div>
                <div class="stat-label">Horas de Desarrollo</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="last-session">2026-02-01</div>
                <div class="stat-label">Última Sesión</div>
            </div>
        </div>

        <div id="sessions-container">
            <!-- Sesiones se añadirán aquí dinámicamente -->
        </div>
    </main>

    <footer>
        <p>> Generated by Claude Code | Last update: <span id="last-update"></span></p>
    </footer>
    </div>

    <script>
        const sessions = [
            {
                id: '20260201_214947',
                date: '2026-02-01',
                time: '21:49',
                duration: '2.0h',
                title: 'Vectorización: Tests, Documentación y Chat UI',
                summary: 'Corrección del bug de concurrencia DbUpdateConcurrencyException en vectorización (Qdrant primero, un solo SaveChangesAsync). Creación de documentación completa del sistema de vectorización (docs/VECTORIZATION.md). 40 tests nuevos para DocumentVectorizationJob y SemanticKernelEmbeddingService. Merge y limpieza de worktrees y ramas. Total: 234 tests.',
                tags: ['bugfix', 'documentation', 'test'],
                docPath: 'sessions/20260201_214947_vectorizacion_tests_docs_chat_ui.md'
            },
            {
                id: '20260130_170204',
                date: '2026-01-30',
                time: '17:02',
                duration: '1.0h',
                title: 'Fase 9: Servicio de Chat RAG',
                summary: 'Implementación completa del servicio de Chat RAG: (1) VectorSearchResult y SearchAsync en IVectorStoreService con filtro por proyecto. (2) Chat Completion configurado para OpenAI y Ollama en Semantic Kernel. (3) IChatService con ChatAsync y ChatStreamAsync. (4) SemanticKernelChatService con flujo RAG completo: embedding consulta, búsqueda vectorial, construcción contexto, llamada LLM. (5) ChatQuery/Handler/Validator de MediatR. (6) Errores de dominio para Chat. 111 tests pasan.',
                tags: ['feature'],
                docPath: 'sessions/20260130_170204_servicio_chat_rag.md'
            },
            {
                id: '20260130_120000',
                date: '2026-01-30',
                time: '12:00',
                duration: '2.5h',
                title: 'Fix: Pipeline Completo de Vectorización con OpenAI',
                summary: 'Corrección del pipeline completo de vectorización: (1) Hangfire no estaba configurado en WebUI, se centralizó AddHangfireServices(). (2) SemanticKernelEmbeddingService usaba interfaz incorrecta, se reescribió para usar ITextEmbeddingGenerationService. (3) DbUpdateConcurrencyException al marcar documentos vectorizados, se creó MarkAsVectorizedAsync() con ExecuteUpdateAsync. (4) Configuración de OpenAI en WebUI. Se generó INFORME_VECTORIZACION.md documentando todo el sistema.',
                tags: ['bugfix', 'documentation'],
                docPath: 'INFORME_VECTORIZACION.md'
            },
            {
                id: '20260126_162831',
                date: '2026-01-26',
                time: '16:28',
                duration: '1.0h',
                title: 'Bugfix: Conexión Qdrant gRPC y Bucle Infinito ChunkingService',
                summary: 'Corrección de dos bugs críticos: (1) QdrantClient usaba puerto REST en lugar de gRPC, causando errores de conexión. Se actualizó la configuración para usar Host/GrpcPort. (2) Bucle infinito en ChunkingService cuando el overlap hacía que nextPosition <= currentPosition. Se mejoró el logging de InMemoryDocumentProcessingQueue para facilitar diagnóstico. 16/16 tests de ChunkingService pasan.',
                tags: ['bugfix'],
                docPath: 'sessions/20260126_162831_bugfix_qdrant_chunking.md'
            },
            {
                id: '20260126_090724',
                date: '2026-01-26',
                time: '09:07',
                duration: '2.0h',
                title: 'Fase 5: WebUI Integration y Fase 6: Hangfire',
                summary: 'Completada la integracion WebUI de Fase 5: FileUpload.razor usa MediatR directamente para subir archivos, Detail.razor carga documentos de BD y permite eliminarlos. Avance en Fase 6: Hangfire configurado con dashboard en /hangfire, DocumentProcessingJob con reintentos automaticos, TextExtractionService para archivos de texto. Jobs se encolan automaticamente despues de upload. Total: 160 tests.',
                tags: ['feature', 'setup'],
                docPath: 'sessions/20260126_090724_fase5_webui_fase6_hangfire.md'
            },
            {
                id: '20260125_202951',
                date: '2026-01-25',
                time: '20:29',
                duration: '1.5h',
                title: 'Fase 3: CRUD Completo de Proyectos',
                summary: 'Completada la Fase 3 con CRUD completo de proyectos. Se implementaron SearchProjectsQuery y handler, ProjectsController con 6 endpoints REST (GET, POST, PUT, DELETE, search), DTOs de request, y 30 tests unitarios para todos los handlers. Total: 88 tests. WebUI conectada a datos reales via MediatR.',
                tags: ['feature', 'test'],
                docPath: 'sessions/20260125_202951_fase3_crud_proyectos.md'
            },
            {
                id: '20260125_193629',
                date: '2026-01-25',
                time: '19:36',
                duration: '2.5h',
                title: 'Fase 2: CQRS con MediatR',
                summary: 'Implementacion completa de infraestructura CQRS: patron Result para manejo funcional de errores, interfaces ICommand/IQuery, behaviors de pipeline (Logging, Validation, ExceptionHandling), repositorios con Unit of Work, y 31 tests unitarios. Resueltos problemas de compatibilidad con MediatR 14 y NSubstitute.',
                tags: ['feature', 'test'],
                docPath: 'sessions/20260125_193629_fase2_cqrs_mediatr.md'
            },
            {
                id: '20260125_164840',
                date: '2026-01-25',
                time: '16:48',
                duration: '2.0h',
                title: 'Fase 1: Infraestructura y Base de Datos',
                summary: 'Implementación completa de la Fase 1: Docker Compose (SQL Server, Qdrant, Azure OCR), migraciones EF Core con DocumentChunk, clases de configuración Options Pattern, QdrantInitializationService, ConfigurationValidator, BabelDbContextFactory. Creación de PLAN_DESARROLLO.md con roadmap de 11 fases y QUICKSTART.md. Corrección de skill end-session para eliminar operaciones git automáticas.',
                tags: ['setup', 'feature', 'documentation'],
                docPath: 'sessions/20260125_164840_fase1_infraestructura.md'
            },
            {
                id: '20260125_151330',
                date: '2026-01-25',
                time: '15:13',
                duration: '0.5h',
                title: 'Health Checks Lazy Load y Correccion de Configuracion',
                summary: 'Se optimizo el componente ServiceStatusIndicator para que los health checks solo se ejecuten bajo demanda (al pulsar el boton), eliminando la carga automatica que causaba retrasos en el arranque. Se corrigio un bug donde WebUI no cargaba appsettings.local.json, causando fallos en la conexion a SQL Server. Se ajusto la posicion del menu de status.',
                tags: ['bugfix', 'refactor'],
                docPath: 'sessions/20260125_151330_healthcheck_lazy_load.md'
            },
            {
                id: '20260125_105026',
                date: '2026-01-25',
                time: '10:50',
                duration: '1.5h',
                title: 'Layout Inicial WebUI con MudBlazor',
                summary: 'Se creo el proyecto Babel.WebUI con Blazor Server y MudBlazor 8.0. Se implemento el layout principal con AppBar, Drawer y tema claro/oscuro. Se crearon componentes: ServiceStatusIndicator (health checks), ProjectCard, FileUpload (drag-and-drop), ChatWindow y ChatMessage (chat RAG). Se anadieron DTOs ProjectDto, DocumentDto y ChatMessageDto. Datos mock con 3 proyectos de ejemplo.',
                tags: ['feature', 'setup'],
                docPath: 'sessions/20260125_105026_layout_webui_mudblazor.md'
            },
            {
                id: '20260125_101719',
                date: '2026-01-25',
                time: '10:17',
                duration: '1.5h',
                title: 'Diseño de Entidades de Dominio',
                summary: 'Se diseñaron e implementaron las entidades de dominio mejoradas para gestionar proyectos y documentos. Se creó la nueva entidad DocumentChunk para soportar chunking en RAG con Qdrant. Se añadieron campos como FileSizeBytes, ContentHash, MimeType, IsVectorized a Document. Se creó proyecto de tests con 27 tests unitarios usando xUnit y FluentAssertions.',
                tags: ['feature', 'test', 'documentation'],
                docPath: 'sessions/20260125_101719_diseno_entidades_dominio.md'
            },
            {
                id: '20260125_101406',
                date: '2026-01-25',
                time: '10:14',
                duration: '0.5h',
                title: 'Creación de Skill Frontend para MudBlazor',
                summary: 'Se creó un skill especializado de Claude Code para desarrollo frontend con Blazor Server y MudBlazor. El skill incluye guías de configuración, patrones de componentes (ProjectCard, FileList, FileUpload, ChatWindow), convenciones de nombrado, integración con MediatR, referencia rápida de MudBlazor y troubleshooting común.',
                tags: ['feature', 'documentation'],
                docPath: 'sessions/20260125_101406_frontend_skill_mudblazor.md'
            },
            {
                id: '20260125_093956',
                date: '2026-01-25',
                time: '09:39',
                duration: '0.5h',
                title: 'Configuración de Secrets con appsettings.local.json',
                summary: 'Se implementó un sistema para proteger las claves sensibles del repositorio. Se creó appsettings.local.json (ignorado por Git) para almacenar secretos, se limpió appsettings.json de credenciales, y se actualizó Program.cs para cargar la configuración local. También se creó una plantilla .example para otros desarrolladores.',
                tags: ['setup', 'documentation'],
                docPath: 'sessions/20260125_093956_configuracion_secrets_appsettings.md'
            },
            {
                id: '20260124_112606',
                date: '2026-01-24',
                time: '11:26',
                duration: '3.5h',
                title: 'Creación del Proyecto Base y Corrección de QdrantClient',
                summary: 'Sesión inicial donde se creó toda la estructura del proyecto Babel usando Clean Architecture con .NET 10.0. Se implementaron las 4 capas (Domain, Application, Infrastructure, API), se configuró Entity Framework Core, y se crearon health checks para verificar las conexiones a SQL Server, Qdrant y Azure OCR. También se resolvió un bug crítico con la inicialización de QdrantClient que requería un objeto Uri en lugar de un string.',
                tags: ['setup', 'bugfix', 'documentation'],
                docPath: 'sessions/20260124_112606_proyecto_base_y_correccion_qdrant.md'
            }
        ];

        // Renderizar timeline
        const timeline = document.getElementById('timeline');
        sessions.forEach((session, index) => {
            const div = document.createElement('div');
            div.className = 'timeline-item' + (index === 0 ? ' active' : '');
            div.dataset.sessionId = session.id;
            div.innerHTML = `
                <div class="timeline-date">${session.date}</div>
                <div class="timeline-time">${session.time}</div>
                <div class="timeline-title">${session.title}</div>
            `;
            div.addEventListener('click', () => {
                document.querySelectorAll('.timeline-item').forEach(item => item.classList.remove('active'));
                div.classList.add('active');
                document.getElementById(`session-${session.id}`)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
            timeline.appendChild(div);
        });

        // Renderizar sesiones
        const container = document.getElementById('sessions-container');
        sessions.forEach(session => {
            const div = document.createElement('div');
            div.className = 'session';
            div.id = `session-${session.id}`;
            div.innerHTML = `
                <div class="session-header">
                    <h2 class="session-title">${session.title}</h2>
                    <div class="session-meta">
                        ${session.date} ${session.time} | ${session.duration}
                    </div>
                </div>
                <div class="session-tags">
                    ${session.tags.map(tag => `<span class="tag ${tag}">[${tag}]</span>`).join('')}
                </div>
                <p class="session-summary">${session.summary}</p>
                <a href="${session.docPath}" class="session-link">>> View docs</a>
            `;
            container.appendChild(div);
        });

        // Actualizar estadísticas
        document.getElementById('total-sessions').textContent = sessions.length;
        const totalHours = sessions.reduce((sum, s) => {
            const hours = parseFloat(s.duration.replace('h', ''));
            return sum + hours;
        }, 0);
        document.getElementById('total-hours').textContent = totalHours.toFixed(1) + 'h';
        document.getElementById('last-session').textContent = sessions[0]?.date || '-';

        // Fecha de última actualización
        document.getElementById('last-update').textContent = new Date().toISOString();

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('light');
        }
    </script>
</body>
</html>
